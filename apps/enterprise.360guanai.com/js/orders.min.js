require(["//cdn17.360guanai.com/bootstrap/3.3.4/js/bootstrap.min.js","//cdn02.360guanai.com/apps/enterprise.360guanai.com/js/controller.min.js","//cdn09.360guanai.com/guanaihui/js/util/jquery.cookie.min.js"],function(){function e(){this.moneyPrefix='<span class="yahei">￥</span>',Controller.call(this),this.loadPortals("orders"),this.refreshLocation(),this.getOrderList(),this.addListenerToOrderLoader(),this.slideDetailPanelSpecial(),this.filterBookings()}e.prototype.nullToNone=function(e){for(key in e)e.hasOwnProperty(key)&&(null===e[key]||"null"===e[key])&&(e[key]="");return e},e.prototype.refreshLocation=function(){$("#location .order-category-name").text($("#dataPanel .order-category-list .active").text())},e.prototype.slideDetailPanel=function(e){if(!("in"===e&&$("#rSide").width()>0||"out"===e&&0===$("#rSide").width())){var t="in"===e?"820px":0,a="in"===e?"820px":0;$("#rSide").animate({width:t},500),$("#dataPanel").animate({marginRight:a},500)}},e.prototype.slideDetailPanelSpecial=function(){var e=this;$("#rSide").click(function(t){e.slideDetailPanel("in"),t.stopPropagation()}),$(document).click(function(){e.slideDetailPanel("out")})},e.prototype.rewritePagination=function(e){var t=this,a=e.pageinfo.TotalCount,n=(e.pageinfo.PageIndex-1)*e.pageinfo.PageSize+e.result.length;$("#dataPanel .total-pagination .total-count").text(a),$("#dataPanel .total-pagination .loaded-count").text(n),$("#loadMoreBtn").off("click"),n===a?$("#loadMoreBtn").text("已加载到最后一条").attr("disabled","disabled"):($("#loadMoreBtn").text("加载下10条订单").removeAttr("disabled"),$("#loadMoreBtn").click(function(){t.loadNextTen()}))},e.prototype.getOrderList=function(){var e="pageindex="+$("#loadMoreBtn").attr("data-pageindex")+"&user_id="+$.cookie(this.cookieKeyConf.userId),t=$("#dataPanel .order-category-list .active").attr("data-filter");t&&(e+="&"+t);var a=this;this.request(this.orderListApiUrl,e,{process:function(e){$.each(e.result,function(e,t){a.addOrderRow({data:t,delayTime:50*e,orderIdOnClick:function(e){a.popDetail(t.orderid),e.stopPropagation()}})}),a.rewritePagination(e)}})},e.prototype.addListenerToOrderLoader=function(){var e=this;$("#dataPanel .order-category-list .btn").click(function(){e.switchOrderCategory(this),e.refreshLocation()}),$("#loadMoreBtn").click(function(){e.loadNextTen()})},e.prototype.loadNextTen=function(){var e=parseInt($("#loadMoreBtn").attr("data-pageindex"),10);$("#loadMoreBtn").attr("data-pageindex",e+1),this.getOrderList()},e.prototype.switchOrderCategory=function(e){var t=$("#dataPanel .order-category-list .btn");$(e).hasClass("active")||($("#dataPanel .list-container table tbody").empty(),$("#loadMoreBtn").attr("data-pageindex","1"),t.removeClass("active"),$(e).addClass("active"),this.getOrderList())},e.prototype.popDetail=function(e){var t=this;this.slideDetailPanel("in"),$("#rSide .tabs-handle li").eq(0).trigger("mouseover"),this.request(this.orderDetailApiUrl,{user_id:$.cookie(this.cookieKeyConf.userId),orderid:e},{process:function(a){$("#rSide").attr("data-orderid",e);var n=a.result.orderinfo;for(key in n)if(n.hasOwnProperty(key)){var o=null===n[key]||"null"===n[key]?"":n[key];$("#orderInfoContainer ."+key).text(o)}$("#orderInfoContainer .address").attr("title",$.cookie(t.cookieKeyConf.address)),$("#orderInfoContainer .contact").text($.cookie(t.cookieKeyConf.contact)),$("#orderInfoContainer .tel").text($.cookie(t.cookieKeyConf.tel)),$("#orderInfoContainer .address").text($.cookie(t.cookieKeyConf.address));var r=a.result.products;$("#orderDetailContainer table tbody").empty(),$.each(r,function(e,a){t.addDetailRow({data:a})});var d=a.result.bookings;$("#orderBespeakContainer table tbody").empty(),$("#orderBespeakContainer .total-panel span").text(d.length),$.each(d,function(e,a){t.addBookingRow({data:a})})}})},e.prototype.filterBookings=function(){$("#orderBespeakContainer .filter-panel .submit").click(function(){var e=$("#orderBespeakContainer .filter-panel input[name='bookingname']").val();""!==e&&(e=$.trim(e).toLowerCase());var t=$("#orderBespeakContainer .filter-panel input[name='idnumber']").val();""!==t&&(t=$.trim(t).toLowerCase());var a=$("#orderBespeakContainer .filter-panel select[name='status']").val(),n=0;$("#orderBespeakContainer table tbody tr").each(function(){var o=0;e&&-1===$(this).find(".bookingname").text().toLowerCase().indexOf(e)&&o++,t&&-1===$(this).find(".idnumber").text().toLowerCase().indexOf(t)&&o++,a&&$.trim($(this).find(".status").text())!==a&&o++,o?$(this).hide("normal"):($(this).show("normal"),n++)}),$("#orderBespeakContainer .total-panel span").text(n)})},e.prototype.addOrderRow=function(e){var t=null===e||null===e.data||void 0===e.data?{}:e.data,a=null===e||null===e.parentNode||void 0===e.parentNode?$("#dataPanel .list-container table tbody"):e.parentNode,n=null===e||null===e.delayTime||void 0===e.delayTime?100:e.delayTime,o=null===e||null===e.orderIdOnClick||void 0===e.orderIdOnClick?null:e.orderIdOnClick;t=this.nullToNone(t);var r=$(document.createElement("TR")).css({display:"none"}),d=$(document.createElement("INPUT")).attr("type","checkbox").attr("name","row-handle").val(t.orderid);r.append($(document.createElement("TD")).append(d));var i=$(document.createElement("A")).attr("href","javascript:void(0);").addClass("opener").attr("data-id",t.orderid).text(t.orderid);o&&i.click(o),r.append($(document.createElement("TD")).addClass("arial").append(i)),r.append($(document.createElement("TD")).text(t.status)),r.append($(document.createElement("TD")).text(t.deliverstatus)),r.append($(document.createElement("TD")).text(t.paymentstatus)),r.append($(document.createElement("TD")).addClass("arial").text(t.createdate)),a.append(r),r.delay(n).show(1500)},e.prototype.addDetailRow=function(e){var t=this,a=null===e||null===e.data||void 0===e.data?{}:e.data,n=null===e||null===e.parentNode||void 0===e.parentNode?$("#orderDetailContainer table tbody"):e.parentNode;a=this.nullToNone(a);var o=$(document.createElement("TR")).attr("data-productid",a.productid);o.append($(document.createElement("TD")).text(a.productname)),o.append($(document.createElement("TD")).addClass("arial").text(a.qutity)),o.append($(document.createElement("TD")).addClass("arial").text(a.returnqutity)),o.append($(document.createElement("TD")).addClass("arial").text(a.updatedate));var r=$(document.createElement("A")).attr("href","javascript:void(0);").text("卡使用状况"),d=$(document.createElement("TD")).append(r);o.append(d),r.click(function(){t.request(t.cardUseStatusApiUrl,{user_id:$.cookie(t.cookieKeyConf.userId),orderid:$("#rSide").attr("data-orderid"),productid:o.attr("data-productid")},{process:function(e){t.createModalDialog({type:"dialog",id:"modalCardUseStatus",tabindex:10}),$("#modalCardUseStatus .modal-content").append($(document.createElement("DIV")).addClass("modal-header").append('<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">卡使用状况</h4>')),$("#modalCardUseStatus .modal-content").append(t.addCardUseStatusRows(e.result)),$("#modalCardUseStatus").modal({keyboard:!0}),$("#modalCardUseStatus").click(function(e){e.stopPropagation()})}})}),n.append(o)},e.prototype.addBookingRow=function(e){var t=null===e||null===e.data||void 0===e.data?{}:e.data,a=null===e||null===e.parentNode||void 0===e.parentNode?$("#orderBespeakContainer table tbody"):e.parentNode;t=this.nullToNone(t);var n=$(document.createElement("TR"));n.append($(document.createElement("TD")).text(t.productname)),n.append($(document.createElement("TD")).text(t.electroniccardno)),n.append($(document.createElement("TD")).text(t.bookingname).addClass("bookingname")),n.append($(document.createElement("TD")).text(t.bookingusergender+"("+t.bookingusermarried+")")),n.append($(document.createElement("TD")).text(t.status).addClass("status")),n.append($(document.createElement("TD")).addClass("arial").text(t.idnumber).addClass("idnumber")),n.append($(document.createElement("TD")).addClass("arial").text(t.bookingphonenumber)),n.append($(document.createElement("TD")).addClass("arial").text(t.bookingstoreDate)),n.append($(document.createElement("TD")).text(t.bookingstorename)),n.append($(document.createElement("TD")).text(t.reportdeliveraddr)),n.append($(document.createElement("TD")).addClass("arial").text(t.lastupdatedate)),a.append(n)},e.prototype.addCardUseStatusRows=function(e){for(var t=$(document.createElement("TABLE")).addClass("table table-hover"),a=$(document.createElement("THEAD")).append($(document.createElement("TR")).append($(document.createElement("TH")).text("卡号")).append($(document.createElement("TH")).text("使用状况"))),n=$(document.createElement("TBODY")),o=0;o<e.length;o++)n.append($(document.createElement("TR")).append($(document.createElement("TD")).text(e[o].electroniccardno)).append($(document.createElement("TD")).text(e[o].cardstatus)));return t.append(a).append(n),$(document.createElement("DIV")).attr("id","cardUseStatusContainer").append(t).css({padding:"15px"})},$(document).ready(function(){new e})});