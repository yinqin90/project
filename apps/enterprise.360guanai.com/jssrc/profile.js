/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1. 项目名称：企业中心 - 关爱体检通
 2. 页面名称：profile (企业信息)
 3. 作者：赵华刚(zhaohuagang@guanaihui.com)
 4. 备注：
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
require([
        "//cdn17.360guanai.com/bootstrap/3.3.4/js/bootstrap.min.js" ,
        "//cdn02.360guanai.com/apps/enterprise.360guanai.com/js/controller.min.js" ,
        "//cdn09.360guanai.com/guanaihui/js/util/jquery.cookie.min.js"
    ], function(){
    function ProfileController() {    
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        继承于Controller基类
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        Controller.call(this) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        加载公共页面
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        this.loadPortals("profile") ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        将cookie中的数据打印到页面上
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        this.bindDataToPage() ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        表单提交处理
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        this.submitForm() ;
    } ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    将cookie中的数据打印到页面上
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    ProfileController.prototype.bindDataToPage = function() {
        $("form input[name='CompanyName']").val($.cookie(this.cookieKeyConf.companyName)) ;
        $("form input[name='Contact']").val($.cookie(this.cookieKeyConf.contact)) ;
        $("form input[name='Tel']").val($.cookie(this.cookieKeyConf.tel)) ;
        $("form input[name='Address']").val($.cookie(this.cookieKeyConf.address)) ;
        $("form textarea[name='Description']").val($.cookie(this.cookieKeyConf.description)) ;
    } ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    表单提交处理
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    ProfileController.prototype.submitForm = function() {
        var classSelf = this ;
        require([
                this.utilStaticPrefix + "/jquery.ajaxsave.min.js"
            ], function(){
            $("form").ajaxsave({
                dataType : classSelf.apiDataType ,
                beforeSaveInterface : function() {
                    $("form").attr("action", classSelf.updateProfileApiUrl) ;
                    $("form input[name='accountid']").val($.cookie(classSelf.cookieKeyConf.userName)) ;
                } ,
                onSavingInterface : function() {
                    classSelf.tips("正在进行处理，请稍等...", 3) ;          
                } ,
                onErrorInterface : function() {
                    classSelf.tips("请求失败，请检查您的接口！", 3) ;                    
                } ,
                onSuccessInterface : function(result) {
                    classSelf.tips("企业信息修改成功！", 3, function(){
                        classSelf.clearCookieRedirect() ;
                    }) ; 
                } ,
                onExceptionInterface : function(message) {                     
                    classSelf.tips("<span class=\"text-danger\">" + message + "</span>", 5) ;
                }
            }) ;
        }) ;
    } ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    类的初始化
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    $(document).ready(function(){
        new ProfileController ;        
    }) ;
}) ;

