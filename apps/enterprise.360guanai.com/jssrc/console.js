/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1. 项目名称：企业中心 - 关爱体检通
 2. 页面名称：console (管理控制台)
 3. 作者：赵华刚(zhaohuagang@guanaihui.com)
 4. 备注：
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
require([
        "//cdn17.360guanai.com/bootstrap/3.3.4/js/bootstrap.min.js" ,
        "//cdn02.360guanai.com/apps/enterprise.360guanai.com/js/controller.min.js" ,
        "//cdn09.360guanai.com/guanaihui/js/util/jquery.cookie.min.js"
    ], function(){
    function ConsoleController() {        
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        继承于Controller基类
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        Controller.call(this) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        加载公共页面
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        this.loadPortals("console") ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        获取数据来转化为图表信息
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        this.initCharts() ;
    } ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    初始化图表信息
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    ConsoleController.prototype.initCharts = function() {
        var classSelf = this ;
        this.request(this.lastOrderChartApiUrl, {
            "user_id" : $.cookie(this.cookieKeyConf.userId)
        }, {
            process : function(data) {
                Highcharts.setOptions({
                    lang : {
                        contextButtonTitle : "图表操作菜单",
                        downloadJPEG : "下载为JPG文件",
                        downloadPDF : "下载为PDF文件",
                        downloadPNG : "下载为PNG文件",
                        downloadSVG : "下载SVG矢量图",
                        noData : "无数据",
                        printChart : "打印图表"
                    }
                }) ;
                /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
                图表个性化配置
                -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
                $("#dataPanel .charts").highcharts({
                    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
                     去掉版权信息
                     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
                    credits : {
                        enabled : false
                    } ,
                    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
                     图表基本配置
                     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
                    chart : { 
                        type : "column" ,
                        animation : {
                            duration : 1000 , //显示动画过程维持时间，单位为毫秒
                            easing : "linear"  //可以是linear| swing
                        } ,
                        backgroundColor : "transparent"  //整个图表的背景色
                    } ,
                    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
                     图表颜色参数等，如果有多个系列，比如柱状图有多个柱子，这里就定义柱子的背景色
                     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
                    //colors : ["#c0ff02", "#8cbb00", "#5f7d00"] ,
                    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
                     设置图表标题
                    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
                    title : {
                        text : $.cookie(classSelf.cookieKeyConf.companyName) + "最近一张订单预约及到检情况统计图表" ,
                        style : {
                            color : "#000" ,
                            font : "normal 2em/30px microsoft yahei,'Lucida Grande',Arial"
                        }
                    } ,
                    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
                     设置图表子标题
                    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
                    subtitle : {
                        text: "技术支持：关爱体检通",
                        style : {
                            color : "#515151",
                            font : "normal 1.16em/30px microsoft yahei,'Lucida Grande',Arial"
                        }
                    } ,
                    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
                     设置图表X轴及Y轴
                    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
                    xAxis: {
                        categories : data.result.xLabelArray ,
                        gridLineColor : "#eee", //网格线颜色
                        gridLineWidth : 0, //网格线宽度
                        lineColor : "#c0c0c0", //轴线颜色
                        lineWidth : 2, //轴线宽度
                        tickLine : "#c0c0c0", //X轴上各个节点小竖线
                        labels : {
                            style : {
                                font : "normal 1em/30px microsoft yahei,'Lucida Grande',Arial"
                            }
                        }
                    } ,
                    yAxis : {
                        gridLineColor : "#eee" , //网格线颜色
                        gridLineWidth : 1 , //网格线宽度
                        lineColor : "#c0c0c0" , //轴线颜色
                        lineWidth : 2 , //轴线宽度                    
                        title : {
                            text : "数量(人)" ,
                            style : {
                                font : "normal 1.16em/30px microsoft yahei,'Lucida Grande',Arial"
                            }
                        }
                    } ,
                    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
                     设置图例样式
                     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
                    legend : {
                        itemStyle : {
                            font : "normal 1.5em/40px microsoft yahei,'Lucida Grande',Arial"
                        }
                    } ,
                    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
                     提示框设置
                     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
                    tooltip : {
                        headerFormat: '<span style="font-size :16px ; font-family : microsoft yahei ; line-height : 35px ;">{point.key}</span><table style="font-size :14px ; font-family : microsoft yahei ; line-height : 25px ;">',
                        pointFormat: '<tr><td style="color:{series.color};">{series.name} ： </td>' +
                            '<td><b>{point.y}</b></td></tr>',
                        footerFormat : '</table>' ,
                        shared : true ,
                        useHTML : true
                    } ,
                    plotOptions : {
                        column : {
                            pointPadding : 0.2 ,
                            borderWidth : 0
                        }
                    } ,
                    series: [{
                        name : "购买数" ,
                        data : data.result.purchaseAmount
                    }, {
                        name : "预约数" ,
                        data : data.result.bookingAmount
                    }, {
                        name : "到检数" ,
                        data : data.result.checkedAmount
                    }]
                });
            }
        }) ;
    } ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    类的初始化
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    $(document).ready(function(){
        new ConsoleController ;        
    }) ;
}) ;

