/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1. 项目名称：企业中心 - 关爱体检通
 2. 页面名称：orders (我的订单)
 3. 作者：赵华刚(zhaohuagang@guanaihui.com)
 4. 备注：
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
require([
        "//cdn17.360guanai.com/bootstrap/3.3.4/js/bootstrap.min.js" ,
        "//cdn02.360guanai.com/apps/enterprise.360guanai.com/js/controller.min.js" ,        
        "//cdn09.360guanai.com/guanaihui/js/util/jquery.cookie.min.js"
    ], function(){
    function OrdersController() {        
        this.moneyPrefix = "<span class=\"yahei\">￥</span>" ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        继承于Controller基类
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        Controller.call(this) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        加载公共页面
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        this.loadPortals("orders") ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        更新当前位置
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        this.refreshLocation() ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        获取订单数据
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        this.getOrderList() ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        给订单数据加载器绑定事件
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        this.addListenerToOrderLoader() ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        点击详情面板滑出(也就是不动)以及body任何地方关闭的功能
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        this.slideDetailPanelSpecial() ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        点击预约面板中的查询按钮对预约记录进行筛选
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        this.filterBookings() ;
    } ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    对数据进行null值转换成""
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    OrdersController.prototype.nullToNone = function(data) {
        for(key in data) {
            if(data.hasOwnProperty(key)) {
                if(data[key] === null || data[key] === "null") data[key] = "" ;
            }
        }
        return data ;
    } ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    更新当前位置
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    OrdersController.prototype.refreshLocation = function() {
        $("#location .order-category-name").text($("#dataPanel .order-category-list .active").text()) ;
    } ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    滑动操作面板
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    OrdersController.prototype.slideDetailPanel = function(status) {
        if((status === "in" && $("#rSide").width() > 0) || (status === "out" && $("#rSide").width() === 0)) return ;
        var nDetailPanelWidth = (status === "in") ? "820px" : 0 ;
        var nDataPanelMarginRight = (status === "in") ? "820px" : 0 ;
        $("#rSide").animate({
            width : nDetailPanelWidth
        }, 500) ;
        $("#dataPanel").animate({
            marginRight : nDataPanelMarginRight
        }, 500) ;
    } ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    点击详情面板滑出(也就是不动)以及body任何地方关闭的功能
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    OrdersController.prototype.slideDetailPanelSpecial = function() {
        var classSelf = this ;
        $("#rSide").click(function(event){
            classSelf.slideDetailPanel("in") ;
            event.stopPropagation() ;
        }) ;
        $(document).click(function(){
            classSelf.slideDetailPanel("out") ;
        }) ;
    } ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    总共多少条，已显示多少条的显示
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    OrdersController.prototype.rewritePagination = function(data) {
        var classSelf = this ;
        var totalCount = data.pageinfo.TotalCount ;
        var loadedCount = (data.pageinfo.PageIndex - 1) * data.pageinfo.PageSize + data.result.length ;
        $("#dataPanel .total-pagination .total-count").text(totalCount) ;
        $("#dataPanel .total-pagination .loaded-count").text(loadedCount) ;
        $("#loadMoreBtn").off("click") ;
        if(loadedCount === totalCount) $("#loadMoreBtn").text("已加载到最后一条").attr("disabled", "disabled") ;
        else {
            $("#loadMoreBtn").text("加载下10条订单").removeAttr("disabled") ;
            $("#loadMoreBtn").click(function(){
                classSelf.loadNextTen() ;
            }) ;
        }
    } ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    获取数据，绘制列表表格
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    OrdersController.prototype.getOrderList = function() {
        var params = "pageindex=" + $("#loadMoreBtn").attr("data-pageindex") + "&user_id=" + $.cookie(this.cookieKeyConf.userId) ;
        var deliverStatus = $("#dataPanel .order-category-list .active").attr("data-filter") ;
        if(deliverStatus) params += ("&" + deliverStatus) ;    
        var classSelf = this ;
        this.request(this.orderListApiUrl, params, {
            process : function(data) {
                /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
                绘制列表表格tbody部分
                -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/                
                $.each(data.result, function(key, value){
                    classSelf.addOrderRow({
                        data : value ,
                        delayTime : key * 50 ,
                        orderIdOnClick : function(event) {
                            classSelf.popDetail(value.orderid) ;
                            event.stopPropagation() ;
                        }
                    }) ;
                }) ;
                /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
                填写总订单数以及已经加载数量
                -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
                classSelf.rewritePagination(data) ;
            }
        }) ;
    } ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    给订单数据加载器绑定事件
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    OrdersController.prototype.addListenerToOrderLoader = function() {
        var classSelf = this ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        类型按钮事件绑定
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $("#dataPanel .order-category-list .btn").click(function(){
            classSelf.switchOrderCategory(this) ;
            /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
            更新当前位置
            -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
            classSelf.refreshLocation() ;
        }) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        加载下10条按钮事件绑定
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $("#loadMoreBtn").click(function(){
            classSelf.loadNextTen() ;
        }) ;
    } ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    加载下10条按钮事件的定义
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    OrdersController.prototype.loadNextTen = function() {
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        先将pageindex加1
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        var pageindex = parseInt($("#loadMoreBtn").attr("data-pageindex"), 10) ;
        $("#loadMoreBtn").attr("data-pageindex", pageindex + 1) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        再加载订单数据
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        this.getOrderList() ;
    } ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    切换订单类型事件的定义
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    OrdersController.prototype.switchOrderCategory = function(toCategoryBtn) {
        var $btns = $("#dataPanel .order-category-list .btn") ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        如果没有切换类型就什么也不干
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        if($(toCategoryBtn).hasClass("active")) return ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        先将表格内容清空
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $("#dataPanel .list-container table tbody").empty() ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        将获取下10条按钮的data-pageindex恢复默认值
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $("#loadMoreBtn").attr("data-pageindex", "1") ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        改变按钮群的active样式
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $btns.removeClass("active") ;
        $(toCategoryBtn).addClass("active") ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        最后获取数据并绘制
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        this.getOrderList() ;
    } ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    点击订单号滑出详情面板并加载数据的方法定义
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    OrdersController.prototype.popDetail = function(orderId) {
        var classSelf = this ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        先弹出详情面板
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        this.slideDetailPanel("in") ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        触发tabs的第一个handle的mouseover
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $("#rSide .tabs-handle li").eq(0).trigger("mouseover") ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        再加载订单基本信息及明细、预约数据
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        this.request(this.orderDetailApiUrl, {
            "user_id" : $.cookie(this.cookieKeyConf.userId) ,
            "orderid" : orderId
        }, {
            process : function(data) {
                /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
                先将orderid绑定到rSide这个容器的data-orderid上，方便后续请求，比如订单详情中产品的卡使用情况，也是要传orderid
                -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
                $("#rSide").attr("data-orderid", orderId) ;
                /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
                再绑定其他数据
                -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
                var orderInfo = data.result.orderinfo ;
                for(key in orderInfo) {
                    if(orderInfo.hasOwnProperty(key)) {
                        var fieldValue = (orderInfo[key] === null || orderInfo[key] === "null") ? "" : orderInfo[key] ;
                        $("#orderInfoContainer ." + key).text(fieldValue) ;
                    }
                }
                $("#orderInfoContainer .address").attr("title", $.cookie(classSelf.cookieKeyConf.address)) ;
                $("#orderInfoContainer .contact").text($.cookie(classSelf.cookieKeyConf.contact)) ;
                $("#orderInfoContainer .tel").text($.cookie(classSelf.cookieKeyConf.tel)) ;
                $("#orderInfoContainer .address").text($.cookie(classSelf.cookieKeyConf.address)) ;               
                var products = data.result.products ;               
                $("#orderDetailContainer table tbody").empty() ;
                $.each(products, function(key, value){
                    classSelf.addDetailRow({
                        data : value
                    }) ;
                }) ;
                var bookings = data.result.bookings ;
                $("#orderBespeakContainer table tbody").empty() ;
                $("#orderBespeakContainer .total-panel span").text(bookings.length) ;
                $.each(bookings, function(key, value){
                    classSelf.addBookingRow({
                        data : value
                    }) ;
                }) ;
            }
        }) ;
    } ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    点击预约面板中的查询按钮对预约记录进行筛选
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    OrdersController.prototype.filterBookings = function() {
        $("#orderBespeakContainer .filter-panel .submit").click(function(){            
            var bookingname = $("#orderBespeakContainer .filter-panel input[name='bookingname']").val() ;
            if(bookingname !== "") bookingname = $.trim(bookingname).toLowerCase() ;
            var idnumber = $("#orderBespeakContainer .filter-panel input[name='idnumber']").val() ;
            if(idnumber !== "") idnumber = $.trim(idnumber).toLowerCase() ;
            var status = $("#orderBespeakContainer .filter-panel select[name='status']").val() ;
            var visibleAmount = 0 ;
            $("#orderBespeakContainer table tbody tr").each(function(){
                var noFitAmount = 0 ;
                if(bookingname && $(this).find(".bookingname").text().toLowerCase().indexOf(bookingname) === -1) noFitAmount ++ ;
                if(idnumber && $(this).find(".idnumber").text().toLowerCase().indexOf(idnumber) === -1) noFitAmount ++ ;
                if(status && $.trim($(this).find(".status").text()) !== status) noFitAmount ++ ;                
                if(noFitAmount) $(this).hide("normal") ;
                else {
                    $(this).show("normal") ;
                    visibleAmount ++ ;
                }
            }) ;
            $("#orderBespeakContainer .total-panel span").text(visibleAmount) ;
        }) ;        
    } ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    添加订单行数据并以slideDown形式下拉出现
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    OrdersController.prototype.addOrderRow = function(params) {
        var data = (params === null || params.data === null || params.data === undefined) ? {} : params.data ;
        var $parentNode = (params === null || params.parentNode === null || params.parentNode === undefined) ? $("#dataPanel .list-container table tbody") : params.parentNode ;
        var delayTime = (params === null || params.delayTime === null || params.delayTime === undefined) ? 100 : params.delayTime ;
        var orderIdOnClick = (params === null || params.orderIdOnClick === null || params.orderIdOnClick === undefined) ? null : params.orderIdOnClick ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        对数据进行null值转换成""
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        data = this.nullToNone(data) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建tr节点，并初始让她隐藏
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        var $tr = $(document.createElement("TR")).css({"display" : "none"}) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建句柄td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        var $rowHandle = $(document.createElement("INPUT")).attr("type", "checkbox").attr("name", "row-handle").val(data.orderid) ;
        $tr.append($(document.createElement("TD")).append($rowHandle)) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建订单编号td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        var $id = $(document.createElement("A")).attr("href", "javascript:void(0);").addClass("opener").attr("data-id", data.orderid).text(data.orderid) ;
        if(orderIdOnClick) {
            $id.click(orderIdOnClick) ;
        }
        $tr.append($(document.createElement("TD")).addClass("arial").append($id)) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建总金额td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        //$tr.append($(document.createElement("TD")).addClass("arial").html(this.moneyPrefix + data.totalamount)) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建折扣金额td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        //$tr.append($(document.createElement("TD")).addClass("arial").html(this.moneyPrefix + data.discount)) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建订单状态td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $tr.append($(document.createElement("TD")).text(data.status)) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建发货状态td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $tr.append($(document.createElement("TD")).text(data.deliverstatus)) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建支付状态td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $tr.append($(document.createElement("TD")).text(data.paymentstatus)) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建是否需要发票td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        //$tr.append($(document.createElement("TD")).text(data.needinvoice)) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建下单日期td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $tr.append($(document.createElement("TD")).addClass("arial").text(data.createdate)) ;    
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        吧tr贴到指定容器下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/    
        $parentNode.append($tr) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        显示整行信息
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $tr.delay(delayTime).show(1500) ;
    } ;

    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    添加订单明细行数据
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    OrdersController.prototype.addDetailRow = function(params) {
        var classSelf = this ;
        var data = (params === null || params.data === null || params.data === undefined) ? {} : params.data ;
        var $parentNode = (params === null || params.parentNode === null || params.parentNode === undefined) ? $("#orderDetailContainer table tbody") : params.parentNode ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        对数据进行null值转换成""
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        data = this.nullToNone(data) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建tr节点，并初始让她隐藏
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        var $tr = $(document.createElement("TR")).attr("data-productid", data.productid) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建产品名称td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/    
        $tr.append($(document.createElement("TD")).text(data.productname)) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建数量td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $tr.append($(document.createElement("TD")).addClass("arial").text(data.qutity)) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建退货数td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $tr.append($(document.createElement("TD")).addClass("arial").text(data.returnqutity)) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建单价td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        //$tr.append($(document.createElement("TD")).addClass("arial").html(this.moneyPrefix + data.unitprice)) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建折扣td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        //$tr.append($(document.createElement("TD")).addClass("arial").html(this.moneyPrefix + data.discount)) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建金额td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        //$tr.append($(document.createElement("TD")).addClass("arial").html(this.moneyPrefix + data.totolamount)) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建最后修改时间td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $tr.append($(document.createElement("TD")).addClass("arial").text(data.updatedate)) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        管理选项td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        var $useStatusANode = $(document.createElement("A")).attr("href", "javascript:void(0);").text("卡使用状况") ;
        var $useStatusTdNode = $(document.createElement("TD")).append($useStatusANode) ;
        $tr.append($useStatusTdNode) ;
        $useStatusANode.click(function(){
            classSelf.request(classSelf.cardUseStatusApiUrl, {
                "user_id" : $.cookie(classSelf.cookieKeyConf.userId) ,
                "orderid" : $("#rSide").attr("data-orderid") ,
                "productid" : $tr.attr("data-productid")
            }, {
                process : function(data){
                    classSelf.createModalDialog({ 
                        "type" : "dialog" ,
                        "id" : "modalCardUseStatus" ,
                        "tabindex" : 10
                    }) ;
                    $("#modalCardUseStatus .modal-content").append($(document.createElement("DIV")).addClass("modal-header").append("<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button><h4 class=\"modal-title\">卡使用状况</h4>"))  ;
                    $("#modalCardUseStatus .modal-content").append(classSelf.addCardUseStatusRows(data.result)) ;
                    $("#modalCardUseStatus").modal({ "keyboard" : true }) ;
                    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
                    阻止dialog框事件冒泡
                    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
                    $("#modalCardUseStatus").click(function(event){
                        event.stopPropagation() ;
                    }) ;
                }
            }) ;        
        }) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        吧tr贴到指定容器下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $parentNode.append($tr) ;
    } ;

    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    添加订单明细行数据
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    OrdersController.prototype.addBookingRow = function(params) {
        var data = (params === null || params.data === null || params.data === undefined) ? {} : params.data ;
        var $parentNode = (params === null || params.parentNode === null || params.parentNode === undefined) ? $("#orderBespeakContainer table tbody") : params.parentNode ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        对数据进行null值转换成""
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        data = this.nullToNone(data) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建tr节点，并初始让她隐藏
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        var $tr = $(document.createElement("TR")) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建产品名称td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/    
        $tr.append($(document.createElement("TD")).text(data.productname)) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建卡号td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $tr.append($(document.createElement("TD")).text(data.electroniccardno)) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建预约人td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $tr.append($(document.createElement("TD")).text(data.bookingname).addClass("bookingname")) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建性别td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $tr.append($(document.createElement("TD")).text(data.bookingusergender + "(" + data.bookingusermarried + ")")) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建状态td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $tr.append($(document.createElement("TD")).text(data.status).addClass("status")) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建身份证号td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $tr.append($(document.createElement("TD")).addClass("arial").text(data.idnumber).addClass("idnumber")) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建手机号td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $tr.append($(document.createElement("TD")).addClass("arial").text(data.bookingphonenumber)) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建预约体检时间td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $tr.append($(document.createElement("TD")).addClass("arial").text(data.bookingstoreDate)) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建预约门店td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $tr.append($(document.createElement("TD")).text(data.bookingstorename)) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建报告寄送地址td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $tr.append($(document.createElement("TD")).text(data.reportdeliveraddr)) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        创建更新时间td节点并贴到tr下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $tr.append($(document.createElement("TD")).addClass("arial").text(data.lastupdatedate)) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        吧tr贴到指定容器下
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $parentNode.append($tr) ;
    } ;

    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    添加卡使用状态明细行数据
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    OrdersController.prototype.addCardUseStatusRows = function(data) {
        var $table = $(document.createElement("TABLE")).addClass("table table-hover") ;
        var $thead = $(document.createElement("THEAD")).append($(document.createElement("TR")).append($(document.createElement("TH")).text("卡号")).append($(document.createElement("TH")).text("使用状况"))) ;
        var $tbody = $(document.createElement("TBODY")) ;
        for(var a = 0 ; a < data.length ; a ++) {
            $tbody.append($(document.createElement("TR")).append($(document.createElement("TD")).text(data[a].electroniccardno)).append($(document.createElement("TD")).text(data[a].cardstatus))) ;
        }
        $table.append($thead).append($tbody) ;
        return $(document.createElement("DIV")).attr("id", "cardUseStatusContainer").append($table).css({"padding" : "15px"}) ;
    } ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    类的初始化
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    $(document).ready(function(){
        new OrdersController ;        
    }) ;
}) ;

