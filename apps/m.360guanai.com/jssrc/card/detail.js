/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1. 项目名称：m.360guanai.com
 2. 页面名称：productList(套餐详情)
 3. 作者：尹芹(yinqin@guanaihui.com)
 4. 备注：
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
function DetailController() {
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    继承于Controller基类
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    Controller.call(this);
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    加载体检项目详情
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.loadCheckItem();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    加载支持门店详情
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.loadSupportStore();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    tab内容切换
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.swapTabs();

    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    iframe 自适应高度
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.reinitFrame();

    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    加入购物车
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.addCart();

};

/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
加载体检项目详情
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
DetailController.prototype.loadCheckItem = function() {
        var _this = this;
        require([
            _this.appStaticPrefix + "/product/items.min.js"
        ], function() {
            $(".tabs-handle li").eq(1).click(function() {
                if ($(this).data('clicked') == undefined) {
                    $("#checkStoreItem").load($("#checkStoreItem").attr('data-href'), function() {
                        new CheckItems({
                            "scope": this
                        });
                    });
                    $(this).data('clicked', '1');
                }
            });

        });
    }
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    加载支持门店详情
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
DetailController.prototype.loadSupportStore = function() {
        var _this = this;
        require([
            _this.appStaticPrefix + "/product/supportStore.min.js"
        ], function() {
            $(".tabs-handle li").eq(2).click(function() {
                if ($(this).data('clicked') == undefined) {
                    $("#supportStore").load($("#supportStore").attr('data-href'), function() {
                        new SupportStore({
                            "scope": this,
                            "triggle": 'click'
                        });
                    });
                    $(this).data('clicked', '1');
                }
            });
        });
    }
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
tab内容切换
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
DetailController.prototype.swapTabs = function() {
    require([this.utilStaticPrefix + "/jquery.tabs.min.js"], function() {
        $(".tabs").tabs({
            "eventType": "click",
            "effect": "slideDown",
            "duration": 200
        });
    });
}

/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
iframe 自适应高度
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
DetailController.prototype.reinitFrame = function() {
      
    }

/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
iframe 自适应高度
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
DetailController.prototype.addCart = function() {
       var classSelf=this;
       $('#btnAddCart').bind('click', function(e) {
        var pId = $(this).data('id');
        var requestData = {
            productId: pId,
            optype: 0,
            qty: 1
        };
        classSelf.request(classSelf.shoppingCardAddApiUrl, requestData, {
            showLoadingTips: false,
            process: function(data) {
                window.location.href = classSelf.shoppingCardUrl;
            }
        });

        return false;
    });
}

    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    类的初始化
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
$(document).ready(function() {
    new DetailController;
});