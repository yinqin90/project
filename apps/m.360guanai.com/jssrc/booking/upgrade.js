/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1. 项目名称：m.360guanai.com
 2. 页面名称：upgrade(套餐升级)
 3. 作者：赵华刚(zhaohuagang@guanaihui.com)
 4. 备注：
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
function UpgradeController() {       
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    继承于Controller基类
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    Controller.call(this) ; 
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    开始过滤按钮事件绑定
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.filterResult() ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    页面滚动监听
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.scrollspy() ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    选中某个套餐后的事件
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.selectSuit() ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    点击查看项目按钮事件绑定
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.listItems() ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    点击查看支持门店按钮事件绑定
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.listSupportStores() ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    tab内容切换
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.swapTabs() ;
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    放弃升级的处理
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.cancelUpgrade() ;
} ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
放弃升级的处理
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
UpgradeController.prototype.cancelUpgrade = function() {
    var classSelf = this ;
    $("#originalSuit .tools .cancel").click(function(){
        classSelf.confirm({
            "content" : "您确定要取消升级吗？" ,
            "confirmInterface" : function() {
                window.location.href = "options.html" ;
            }
        }) ;
    }) ;
} ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
tab内容切换
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
UpgradeController.prototype.swapTabs = function() {
    require([this.utilStaticPrefix + "/jquery.tabs.min.js"], function() {
        $(".tabs").tabs({
            "eventType": "click",
            "effect": "slideDown",
            "duration": 200
        });
    }) ;
    $("#destinationSuit .tabs-handle li").eq(0).click(function(){
        $("#filterResult").show() ;
    }) ;
    $("#destinationSuit .tabs-handle li").eq(1).click(function(){
        $("#filterResult").hide(100) ;
    }) ;
} ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
开始过滤按钮事件绑定
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
UpgradeController.prototype.filterResult = function() {
    $("#searchBtn").click(function(){
        $("#filterResult").slideDown(100) ;
    }) ;
} ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
页面滚动监听
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
UpgradeController.prototype.scrollspy = function() {
    $(window).scroll(function(){
        var filterPanelPosition = $(".filter-panel").position() ;
        if($(window).scrollTop() > filterPanelPosition.top) $(".filter-panel").css({ "position" : "fixed" , "top" : "0", "left" : "0" , "width" : "100%" , "z-index" : "1000" }).addClass("portal") ;
        else $(".filter-panel").css({ "position" : "static" }).removeClass("portal") ;
    }) ;
} ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
选中某个套餐后的事件
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
UpgradeController.prototype.selectSuit = function() {
    $("#filterResult .upgrade").click(function(){
        $("#filterResult").hide() ;
        $("#destinationSuit .tabs-handle li").eq(1).trigger("click") ;
    }) ;
    $("#reFilter").click(function(){
        $("#destinationSuit .tabs-handle li").eq(0).trigger("click") ;
        $("#filterResult").hide() ;
    }) ;
} ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
点击查看项目按钮事件绑定
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
UpgradeController.prototype.listItems = function() {
    var classSelf = this ;
    require([        
        this.appStaticPrefix + "/floatWindow.min.js" ,
        this.appStaticPrefix + "/product/items.min.js"
    ], function() {
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        首先实例化一个查看所有体检项目的浮动窗口
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        var floatWindow = new FloatWindow({
            "popTrigger" : $(".list .tools .items") ,
            "floatWindows" : $("#checkItemsWindow")
        }) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        然后实例化一个体检项目的内容逻辑的类
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $(".list .tools .items").click(function(){
            $("#checkItemsWindow .float-window-body").empty() ;
            $("#checkItemsWindow .float-window-body").load($(this).attr("data-href"), function(){
                new CheckItems({ "scope" : this}) ;
            }) ;
        }) ;
    }) ;   
} ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
点击查看支持门店按钮事件绑定
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
UpgradeController.prototype.listSupportStores = function() {
    var classSelf = this ;
    require([
        this.appStaticPrefix + "/floatWindow.min.js" ,
        this.appStaticPrefix + "/product/supportStore.min.js"
    ], function() {
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        首先实例化一个查看所有体检项目的浮动窗口
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        var floatWindow = new FloatWindow({
            "popTrigger" : $(".list .tools .support-stores") ,
            "floatWindows" : $("#supportStoreWindow")
        }) ;
        /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
        然后实例化一个体检项目的内容逻辑的类
        -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
        $(".list .tools .support-stores").click(function(){
            $("#supportStoreWindow .float-window-body").empty() ;
            $("#supportStoreWindow .float-window-body").load($(this).attr("data-href"), function(){
                new SupportStore({ "scope" : this}) ;
            }) ;
        }) ;
    }) ;   
} ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
类的初始化
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
$(document).ready(function(){
    new UpgradeController ;
}) ;
