/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1. 项目名称：m.360guanai.com
 2. 页面名称：Login(预约登录)
 3. 作者：赵华刚(zhaohuagang@guanaihui.com)
 4. 备注：
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
function LoginController() {
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    继承于Controller基类
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    Controller.call(this);
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    初始化页面状态
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.switchTo($("#loginTypeHandle .btn-success").attr("for"));
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    给切换按钮绑定事件
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.addListenerToTypeBtn();

    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    登陆表单提交
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.submitForm();
};
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
切换到指定类型tab
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
LoginController.prototype.switchTo = function(type) {
    $("form .tabs-frame").hide(100);
    $("form ." + type).show(100);
};

/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
给切换按钮绑定事件
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
LoginController.prototype.addListenerToTypeBtn = function() {
    var classSelf = this ;
    $("#loginTypeHandle .btn").click(function(){   
        var _this=$(this);   
        var tabTag=_this.attr('for');
        var $tab=$('.tabs-frame.'+tabTag);

        $("#loginTypeHandle .btn").removeClass("btn-success").addClass("btn-default") ;
        _this.removeClass("btn-default").addClass("btn-success") ;
        classSelf.switchTo(tabTag);

        $('form input[name="loginType"]').val($tab.att('for'));
        $('.tabs-frame').find('input').attr('data-validation-engine','').val('');
        $tab.find('input').attr('data-validation-engine','validate[required]');
    }) ;
} ;
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
登陆表单提交
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
LoginController.prototype.submitForm = function() {
    var classSelf = this;

    require(['//cdn01.360guanai.com/guanaihui/jssrc/jquery.ajaxsave.js'], function() {

        $('form').ajaxsave({
            dataType: classSelf.apiDataType,
            beforeSaveInterface: function() {
                $("form").attr("action", classSelf.bookingLoginApiUrl);
            },
            onSavingInterface: function() {
                classSelf.tips("正在进行处理，请稍等...", 3);
            },
            onErrorInterface: function() {
                classSelf.tips("请求失败，请检查您的接口！", 3);
            },
            onSuccessInterface: function(returnUrl) {
                /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
                首先设置cookie
                -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/

                /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
                再跳转页面
                -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
                window.location.href = classSelf.welcomeUrl;
            },
            onExceptionInterface: function(message) {
                classSelf.tips("<span class=\"text-danger\">" + message + "</span>", 5);
            }
        });
    });
}


/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
类的实例化化
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
$(document).ready(function() {
    new LoginController;
});