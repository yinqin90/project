/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1. 项目名称：m.360guanai.com
 2. 页面名称：consulation(检前咨询页面)
 3. 作者：尹芹(yinqin@guanaihui.com)
 4. 备注：
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
function ConsulationController() {
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
       初始化请求路径
      -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.setting = {
        VAR_API_URL: 'http://121.40.240.212:8088/'
    };
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    继承于Controller基类
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    Controller.call(this);
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
   是否显示头部header
   -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.toggleHeader();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
   提交form表单
   -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.submitForm();

    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    验证手机号码格式
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.isphone = function (phone) {
        var pattern = new RegExp(/^1[3|4|5|8|7][0-9]\d{8}$/);
        return pattern.test(phone);
    };
};

/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
是否需要header
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
ConsulationController.prototype.toggleHeader = function () {
    require([this.utilStaticPrefix + "/url/url.min.js"], function () {
        var urlParam = $.url('?');
        if (urlParam && 'header' in urlParam) {
            urlParam.header === 'true' ? $('header').show() : $('header').hide();
        }
    });
};

ConsulationController.prototype.submitForm = function () {
    var _this = this;
    if ($("#confirmtel").size === 0) return;
    $("#confirmtel").click(function () {
        var orderdetail = '检前咨询(APP咨询)',
            name = $('#name').val() || "手机用户",
            tel = $('#tel').val(),
            address = $('#address').val(),
            uri = _this.setting.VAR_API_URL + 'Customer/CreateConsulation' + '?type=4&remark=' + orderdetail + "&Name=" + name + "&PhoneNumber=" + tel + "&Address=" + address + "&callback=?";
        if (!_this.isphone(tel)) {
            $(window).scrollTop(0);
            _this.tips("请正确输入您的手机号码！", 30);
            return false;
        }
        $.ajax({
            type: "GET",
            url: uri,
            data: {},
            cache: false,
            error: function () {
                $(window).scrollTop(0);
                _this.tips("程序出错,请联系管理员.", 30);
            },
            dataType: "jsonp",
            jsonp: 'callback',
            success: function (data) {
                if (data) {
                    $(window).scrollTop(0);
                    _this.tips("您的联系方式已经保存,我们的销售人员将和您电话确认", 30);
                }
            }
        });
    });
}
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
类的初始化
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
$(document).ready(function () {
    new ConsulationController;
});