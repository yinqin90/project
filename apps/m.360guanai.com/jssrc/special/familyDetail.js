/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1. 项目名称：m.360guanai.com
 2. 页面名称：familyDetail(关爱家人详情页面)
 3. 作者：尹芹(yinqin@guanaihui.com)
 4. 备注：
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
function FamilyDetailController() {
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    初始化请求路径
   -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.setting = {
        VAR_API_URL: 'http://121.40.240.212:8088/'
    };
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    继承于Controller基类
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    Controller.call(this);
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
   是否显示头部header
   -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.toggleHeader();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
   显示更多
   -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.swapTabs();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
    弹出框电话号码样式
    -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.showPhoneModual();
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
   验证手机号码格式
   -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    this.isphone = function (phone) {
        var pattern = new RegExp(/^1[3|4|5|8|7][0-9]\d{8}$/);
        return pattern.test(phone);
    };
};

/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
是否需要header
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
FamilyDetailController.prototype.toggleHeader = function () {
    require([this.utilStaticPrefix + "/url/url.min.js"], function () {
        var urlParam = $.url('?');
        if (urlParam && 'header' in urlParam) {
            urlParam.header === 'true' ? $('header').show() : $('header').hide();
        }
    })
}
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
tab内容切换
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
FamilyDetailController.prototype.swapTabs = function () {
    require([this.utilStaticPrefix + "/jquery.tabs.min.js"], function () {
        $(".tabs").tabs({
            "eventType": "click",
            "effect": "slideDown",
            "duration": 200
        });
    })
};
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
弹出框电话号码样式
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
FamilyDetailController.prototype.showPhoneModual = function () {
    var _this = this;
    $("#btnReserve").click(function () {
        _this.dialog({
            "tabindex": 1,
            "id": "phoneNum",
            "effect": false,
            "url": "/html/special/phoneNumDialog.html"
        });
        $('#phoneNum').on('loaded.bs.modal', function (e) {
            $("#confirmtel").click(function () {
                var storename = $("#banner h3").text().trim(),
                    orderdetail = $("#storetype").val() + " : " + storename,
                    name = '手机用户',
                    tel = $('#tel').val(),
                    uri = _this.setting.VAR_API_URL + 'Customer/CreateConsulation' + '?type=3&remark=' + orderdetail + "&Name=" + name + "&PhoneNumber=" + tel + "&callback=?";
                if (!_this.isphone(tel)) {
                    $(".errorMsg").text("请正确输入您的手机号码!", 30);
                    return false;
                }
                $.ajax({
                    type: "GET",
                    url: uri,
                    data: {},
                    cache: false,
                    error: function () {
                        $(".errorMsg").text("程序出错,请联系管理员.", 30);
                    },
                    dataType: "jsonp",
                    jsonp: 'callback',
                    success: function (data) {
                        if (data) {
                            $('#phoneNum').modal('hide');
                            _this.tips('您的联系方式已经保存,我们的销售人员将和您电话确认', 30);
                        }
                    }
                });
            });
        });
    });
}
/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
类的初始化
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
$(document).ready(function () {
    new FamilyDetailController;
});